{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/huntridge-labs/argus/0.4.0/.github/actions/parse-container-config/schemas/container-config.schema.json",
  "title": "Container Registry Configuration",
  "description": "Configuration schema for matrix container scanning across multiple registries",
  "type": "object",
  "required": [
    "containers"
  ],
  "properties": {
    "containers": {
      "type": "array",
      "description": "List of container images to scan",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": [
          "name",
          "image"
        ],
        "properties": {
          "name": {
            "type": "string",
            "description": "Unique identifier for this container (used in scan artifacts)",
            "pattern": "^[a-zA-Z0-9_-]+$",
            "minLength": 1,
            "maxLength": 50
          },
          "image": {
            "oneOf": [
              {
                "type": "string",
                "description": "Full container image reference string (e.g., nginx:latest, ghcr.io/owner/image:tag, 123456.dkr.ecr.region.amazonaws.com/image:tag, nginx:latest@sha256:abc123)",
                "minLength": 1
              },
              {
                "type": "object",
                "description": "Structured container image reference with individual components (registry host specified separately in registry.host)",
                "required": [
                  "name"
                ],
                "properties": {
                  "repository": {
                    "type": "string",
                    "description": "Repository/organization path within the registry (e.g., library, myorg/myteam). Optional - used to construct full image path.",
                    "minLength": 1
                  },
                  "name": {
                    "type": "string",
                    "description": "Image name (e.g., nginx, ubuntu, myapp). Required.",
                    "pattern": "^[a-z0-9]+(?:[._/-][a-z0-9]+)*$",
                    "minLength": 1
                  },
                  "tag": {
                    "type": "string",
                    "description": "Image tag/version (e.g., latest, v1.0, 1.2.3). Defaults to 'latest' if omitted.",
                    "pattern": "^[a-zA-Z0-9_][a-zA-Z0-9._-]{0,127}$",
                    "minLength": 1,
                    "default": "latest"
                  },
                  "digest": {
                    "type": "string",
                    "description": "Image digest for pinned versions (e.g., sha256:abc123def456). When specified, the image is pinned to this exact digest regardless of tag.",
                    "pattern": "^[a-z0-9]+:[a-f0-9]{64}$",
                    "minLength": 71
                  }
                },
                "additionalProperties": false
              }
            ]
          },
          "registry": {
            "type": "object",
            "description": "Registry configuration including host and authentication",
            "properties": {
              "host": {
                "type": "string",
                "description": "Container registry host (e.g., docker.io, ghcr.io, 123456.dkr.ecr.us-east-1.amazonaws.com)",
                "minLength": 1
              },
              "username": {
                "type": "string",
                "description": "Registry username - supports literal values or ${VAR_NAME} syntax for environment variable expansion (e.g., 'AWS', '_json_key', '${GHCR_USERNAME}')",
                "minLength": 1
              },
              "auth_secret": {
                "type": "string",
                "description": "Name of the GitHub repository secret containing the registry password/token (e.g., 'GITHUB_TOKEN', 'DOCKERHUB_TOKEN', 'ECR_PASSWORD'). Optional - omit for public registries.",
                "pattern": "^[A-Z0-9_]+$",
                "minLength": 1
              }
            },
            "additionalProperties": false
          },
          "scanners": {
            "type": "array",
            "description": "List of scanners to run for this container",
            "items": {
              "type": "string",
              "enum": [
                "trivy",
                "grype",
                "syft"
              ]
            },
            "uniqueItems": true,
            "minItems": 1,
            "default": [
              "trivy",
              "grype"
            ]
          },
          "enable_code_security": {
            "type": "boolean",
            "description": "Whether to upload SARIF to GitHub Security tab",
            "default": false
          },
          "fail_on_severity": {
            "type": "string",
            "description": "Fail the scan if vulnerabilities at or above this severity are found",
            "enum": [
              "none",
              "low",
              "medium",
              "high",
              "critical"
            ],
            "default": "none"
          },
          "allow_failure": {
            "type": "boolean",
            "description": "Allow the workflow to continue even if scanning or validation fails",
            "default": false
          },
          "post_pr_comment": {
            "type": "boolean",
            "description": "Whether to post PR comments for this scan",
            "default": false
          }
        }
      }
    }
  }
}
